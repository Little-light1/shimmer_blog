<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Shimmer&#39;s Blog</title>
  <icon>https://www.gravatar.com/avatar/fd7392a28c5d2348aa0c6e6579484cc7</icon>
  <subtitle>黑暗中寻光的人</subtitle>
  <link href="https://gitee.com/shimmer612/shimmer-blog/atom.xml" rel="self"/>
  
  <link href="https://gitee.com/shimmer612/shimmer-blog/"/>
  <updated>2021-02-24T07:30:24.443Z</updated>
  <id>https://gitee.com/shimmer612/shimmer-blog/</id>
  
  <author>
    <name>Shimmer</name>
    <email>zhangdazhen@126.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>davJs学习02</title>
    <link href="https://gitee.com/shimmer612/shimmer-blog/2021/02/24/umi%E4%B8%AD%EF%BC%8Cdavjs%E5%AD%A6%E4%B9%A002/"/>
    <id>https://gitee.com/shimmer612/shimmer-blog/2021/02/24/umi%E4%B8%AD%EF%BC%8Cdavjs%E5%AD%A6%E4%B9%A002/</id>
    <published>2021-02-23T16:00:00.000Z</published>
    <updated>2021-02-24T07:30:24.443Z</updated>
    
    <content type="html"><![CDATA[<p><strong>最近公司新项目用的UmiJs3.x，整个项目的数据，通过内置的Davjs来控制。</strong></p><p><strong>昨天自己分析了一下Davjs。但是脑海中的概念还是很模糊。今天再梳理一下。</strong></p><h5 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h5><p><strong>首先是在Models文件夹下创建一个JS文件</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> GlobalModel = &#123;</span><br><span class="line">    <span class="comment">//model的名称</span></span><br><span class="line">  namespace: <span class="string">&quot;global&quot;</span>,</span><br><span class="line">  state: &#123;</span><br><span class="line">      <span class="comment">//放数据的地方</span></span><br><span class="line">      user:&#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  effects: &#123;</span><br><span class="line">    <span class="comment">// 异步获取数据，不能直接修改数据，需要通过put调用reducers的方法。</span></span><br><span class="line">     <span class="string">`其中call和普通是dva 提供的effect 函数内部的处理函数</span></span><br><span class="line"><span class="string">      call：执行异步函数， put：发出一个 Action，类似于 dispatch  select获取数据，`</span></span><br><span class="line">      *<span class="function"><span class="title">getTableData</span>(<span class="params">&#123; payload &#125;, &#123; put, select, call &#125;</span>)</span> &#123;</span><br><span class="line">          </span><br><span class="line"> <span class="keyword">const</span> tableList = <span class="keyword">yield</span> select(<span class="function">(<span class="params">state</span>) =&gt;</span> state.global.tableData);</span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">&quot;setTableParams&quot;</span>,</span><br><span class="line">        payload,</span><br><span class="line">      &#125;);</span><br><span class="line">      </span><br><span class="line">  &#125;,</span><br><span class="line">  reducers: &#123;</span><br><span class="line">   <span class="comment">//同步获取数据</span></span><br><span class="line">      <span class="function"><span class="title">setTableParams</span>(<span class="params">state</span>)</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">              ...state</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> GlobalModel;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h5><p><strong>对应页面中</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">&quot;umi&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TableDemo = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//能直接获取到users</span></span><br><span class="line">    <span class="keyword">const</span> &#123;dispatch, users&#125; = props</span><br><span class="line">    </span><br><span class="line">    dispatch(&#123;</span><br><span class="line">        <span class="comment">//global这个model中，getTableData这个异步操作函数</span></span><br><span class="line">      type: <span class="string">&quot;global/getTableData&quot;</span>,</span><br><span class="line">      payload: &#123;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &#123;users.name&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//把global中state中的数据绑定到页面的props上</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(<span class="function">(<span class="params">&#123; <span class="built_in">global</span> &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  users: <span class="built_in">global</span>.users</span><br><span class="line">&#125;))(TableDemo);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>还可以调用Service文件夹里的接口，获取数据</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;最近公司新项目用的UmiJs3.x，整个项目的数据，通过内置的Davjs来控制。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;昨天自己分析了一下Davjs。但是脑海中的概念还是很模糊。今天再梳理一下。&lt;/strong&gt;&lt;/p&gt;
&lt;h5 id=&quot;第一步&quot;&gt;</summary>
      
    
    
    
    
    <category term="Davjs" scheme="https://gitee.com/shimmer612/shimmer-blog/tags/Davjs/"/>
    
    <category term="React" scheme="https://gitee.com/shimmer612/shimmer-blog/tags/React/"/>
    
    <category term="UmiJs" scheme="https://gitee.com/shimmer612/shimmer-blog/tags/UmiJs/"/>
    
  </entry>
  
  <entry>
    <title>关于我</title>
    <link href="https://gitee.com/shimmer612/shimmer-blog/2021/02/23/%E5%85%B3%E4%BA%8E%E6%88%91/"/>
    <id>https://gitee.com/shimmer612/shimmer-blog/2021/02/23/%E5%85%B3%E4%BA%8E%E6%88%91/</id>
    <published>2021-02-22T16:00:00.000Z</published>
    <updated>2021-02-23T08:49:18.453Z</updated>
    
    <content type="html"><![CDATA[<p>姓名：张振</p><p>年龄：25</p><p>现居：江苏-常州</p><hr><p><strong>路</strong></p><p><strong>很长</strong></p><p><strong>顺道寻光</strong></p><img src="https://avatars.githubusercontent.com/u/58460937?s=460&u=2262a14212d169693533720c53b02167303cab09&v=4" style="zoom:50%;" />]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;姓名：张振&lt;/p&gt;
&lt;p&gt;年龄：25&lt;/p&gt;
&lt;p&gt;现居：江苏-常州&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;路&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;很长&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;顺道寻光&lt;/strong&gt;&lt;/p&gt;
&lt;img src=&quot;h</summary>
      
    
    
    
    
    <category term="Aboutme" scheme="https://gitee.com/shimmer612/shimmer-blog/tags/Aboutme/"/>
    
  </entry>
  
  <entry>
    <title>Dav结构的分析</title>
    <link href="https://gitee.com/shimmer612/shimmer-blog/2021/02/22/davjs%E5%AD%A6%E4%B9%A0/"/>
    <id>https://gitee.com/shimmer612/shimmer-blog/2021/02/22/davjs%E5%AD%A6%E4%B9%A0/</id>
    <published>2021-02-22T10:34:00.000Z</published>
    <updated>2021-02-23T02:22:05.583Z</updated>
    
    <content type="html"><![CDATA[<p>下面是davjs   models的一个基本结构</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"> <span class="comment">//dav model的名字</span></span><br><span class="line">namespace: <span class="string">&#x27;example&#x27;</span>,</span><br><span class="line"></span><br><span class="line"><span class="comment">//数据</span></span><br><span class="line">state: &#123;<span class="attr">num</span>:<span class="number">1</span>&#125;, <span class="comment">//表示当前的example中的state状态，这里可以给初始值，这里num初始为1</span></span><br><span class="line"> </span><br><span class="line"> <span class="comment">//这里是做异步处理的相当于VueX的action</span></span><br><span class="line">effects: &#123; </span><br><span class="line"> <span class="comment">//payload是参数   put触发action ，select获取数据， call异步操作   </span></span><br><span class="line">*<span class="function"><span class="title">addByONe</span>(<span class="params">&#123; payload&#125;, &#123; call, put,select &#125;</span>)</span> &#123; </span><br><span class="line">    </span><br><span class="line"> <span class="comment">//这里使用select</span></span><br><span class="line"><span class="keyword">const</span> num = <span class="keyword">yield</span> select(<span class="function"><span class="params">state</span> =&gt;</span> state.num) <span class="comment">//这里就获取到了当前state中的数据num</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> param1;</span><br><span class="line"> </span><br><span class="line">param1 = num + payload; 这里就可以使用num进行操作了</span><br><span class="line"></span><br><span class="line"><span class="keyword">yield</span> put(&#123;</span><br><span class="line">type: <span class="string">&#x27;save&#x27;</span>,</span><br><span class="line">num:param1</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">   </span><br><span class="line"><span class="comment">//用来保存更新state值 上面的put方法调用这里的方法,</span></span><br><span class="line">reducers: &#123;</span><br><span class="line"><span class="function"><span class="title">save</span>(<span class="params">state, action</span>)</span> &#123; <span class="comment">//这里的state是当前总的state，这里的action包含了上面传递的参数和type</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">return</span> &#123; ...state, ...action.num &#125;; <span class="comment">//这里用ES6语法来更新当前state中num的值</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;下面是davjs   models的一个基本结构&lt;/p&gt;
&lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span</summary>
      
    
    
    
    
    <category term="Davjs" scheme="https://gitee.com/shimmer612/shimmer-blog/tags/Davjs/"/>
    
    <category term="React" scheme="https://gitee.com/shimmer612/shimmer-blog/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>新年快乐</title>
    <link href="https://gitee.com/shimmer612/shimmer-blog/2021/02/11/hello-world/"/>
    <id>https://gitee.com/shimmer612/shimmer-blog/2021/02/11/hello-world/</id>
    <published>2021-02-10T16:00:00.000Z</published>
    <updated>2021-02-23T05:25:35.342Z</updated>
    
    <content type="html"><![CDATA[<p><strong>大家新年快乐</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;大家新年快乐&lt;/strong&gt;&lt;/p&gt;
</summary>
      
    
    
    
    
  </entry>
  
</feed>
